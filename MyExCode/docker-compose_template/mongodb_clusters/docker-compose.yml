version: "3.7"
services:
    mongo1:
        image: mongo
        container_name: mongo1
        ports:
            - 31141:27017
        command: mongod --replSet RS --bind_ip_all --dbpath /data/db
        volumes:
            - ./docker/data/mongo1:/data/db

    mongo2:
        image: mongo
        container_name: mongo2
        ports:
            - 31142:27017
        command: mongod --replSet RS --bind_ip_all --dbpath /data/db
        volumes:
            - ./docker/data/mongo2:/data/db

    mongo3:
        image: mongo
        container_name: mongo3
        ports:
            - 31143:27017
        command: mongod --replSet RS --bind_ip_all --dbpath /data/db
        volumes:
            - ./docker/data/mongo3:/data/db

    redis:
        container_name: redis
        hostname: redis-container
        image: redis:3
        ports:
            - 31119:6379
    mysql:
        container_name: mysql
        hostname: mysql-container
        image: mysql:5.7
        ports:
            - 31116:3306
        environment:
            MYSQL_ROOT_PASSWORD: root
        volumes:
            - ./docker/data/mysql:/var/lib/mysql
            - ./docker/log/mysql:/var/log/mysql
            - ./docker/conf/mysql:/etc/mysql/conf.d
    admin:
        container_name: admin
        build: .
        hostname: admin-container
        env_file: ./avnight.env
        volumes:
            - .:/usr/src/app
        ports:
            - 35000:5000
        command: ping 127.0.0.1
        depends_on:
            - redis
            - mysql
            - mongo1